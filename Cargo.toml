[package]
name = "rainbear"
version = "0.1.0"
edition = "2024"
publish = false
description = "Build lazy Zarr scans with Polars"
authors = ["Benjamin Sobel <ben-developer@opayq.com>"]
license = "MIT"
repository = "https://github.com/UserNobody14/iozarrpy"
documentation = "https://github.com/UserNobody14/iozarrpy"
keywords = ["zarr", "polars", "lazy"]
categories = ["data-processing"]


[lib]
name = "_core"
# "cdylib" is necessary to produce a shared library for Python to import from.
crate-type = ["cdylib"]

[dependencies]
# "extension-module" tells pyo3 we want to build an extension module (skips linking against libpython.so)
# "abi3-py39" tells pyo3 (and maturin) to build using the stable ABI with minimum Python version 3.9
pyo3 = { version = "0.26.0", features = ["extension-module", "abi3-py39"] }

# Get polars from git.
#
# IMPORTANT: these features must match Python Polars' enabled DSL surface area; otherwise Expr
# deserialization can decode to the wrong FunctionExpr variants (feature-gated enum variant index drift).
#
# This list is mirrored from Polars' `polars-python` crate for the `py-1.36.1` tag.
polars = { git = "https://github.com/pola-rs/polars.git", tag = "py-1.36.1", features = [
    "abs",
    "approx_unique",
    "array_any_all",
    "arg_where",
    "bitwise",
    "business",
    "concat_str",
    "cum_agg",
    "cumulative_eval",
    "dataframe_arithmetic",
    "month_start",
    "month_end",
    "offset_by",
    "diagonal_concat",
    "diff",
    "dot_diagram",
    "dot_product",
    "dtype-categorical",
    "dtype-extension",
    "dtype-full",
    "dynamic_group_by",
    "ewma",
    "ewma_by",
    "fmt",
    "fused",
    "interpolate",
    "interpolate_by",
    "is_first_distinct",
    "is_last_distinct",
    "is_unique",
    "is_between",
    "is_in",
    "is_close",
    "lazy",
    "list_eval",
    "list_to_struct",
    "list_arithmetic",
    "array_arithmetic",
    "array_to_struct",
    "log",
    "mode",
    "moment",
    "ndarray",
    "partition_by",
    "product",
    "random",
    "range",
    "rank",
    "reinterpret",
    "replace",
    "rolling_window",
    "rolling_window_by",
    "round_series",
    "row_hash",
    "rows",
    "semi_anti_join",
    "serde-lazy",
    "string_encoding",
    "string_normalize",
    "string_reverse",
    "string_to_integer",
    "string_pad",
    "strings",
    "temporal",
    "timezones",
    "to_dummies",
    "true_div",
    "unique_counts",
    "zip_with",
    "cov",
] }
polars-lazy = { git = "https://github.com/pola-rs/polars.git", tag = "py-1.36.1", features = [
    "dtype-extension",
    "dtype-full",
    "ffi_plugin",
    "python"
] }
pyo3-polars = { git = "https://github.com/pola-rs/polars.git", tag = "py-1.36.1", features = [
    "object",
    "dtype-extension",
    "derive",
    "lazy",
    "dtype-full",
] }
tokio = { version = "1.45.1", features = ["rt-multi-thread", "macros", "sync"] }
url = "2.5.4"
zarrs = { version = "0.23.0-beta.3", features = ["async"] }
zarrs_object_store = { version = "0.6.1", features = [
    "aws",
    "azure",
    "gcp",
    "http",
    "fs",
] }
serde_json = "1.0.145"
chrono = { version = "0.4", features = ["clock", "std"] }
futures = "0.3.31"
pyo3-async-runtimes = { version = "0.26.0", features = ["tokio-runtime"] }

# Builds on this machine have intermittently hit compiler crashes (GCC ICE while compiling
# `zstd-sys` at `-O3`, and rustc SIGSEGVs in optimized builds). We intentionally dial back
# release optimization and disable LTO for stability.
[profile.release]
opt-level = 1
lto = false
codegen-units = 4
